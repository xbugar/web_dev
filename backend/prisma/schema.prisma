generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id        String @id @default(uuid()) @db.Uuid
    firstName String
    lastName  String
    email     String @unique

    isAdmin        Boolean @default(false)
    hashedPassword String
    passwordSalt   String

    profilePicture   ProfilePicture @relation(fields: [profilePictureId], references: [id])
    profilePictureId String         @db.Uuid
    notebooks        Notebook[]
    calendar         Calendar?
    flashDecks       FlashDeck[]
    tags             Tag[]
}

model ProfilePicture {
    id      String @id @default(uuid()) @db.Uuid
    picture Bytes

    users User[]
}

model Notebook {
    id String @id @default(uuid()) @db.Uuid

    title       String
    description String
    color       String

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId     String      @db.Uuid
    icon       Icon        @relation(fields: [iconId], references: [id])
    iconId     String      @db.Uuid
    notes      Note[]
    flashDecks FlashDeck[]
    tags       Taggable[]
}

model Note {
    id String @id @default(uuid()) @db.Uuid

    title   String
    color   String
    content String @default("")

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    notebook   Notebook @relation(fields: [notebookId], references: [id], onDelete: Cascade)
    notebookId String   @db.Uuid @unique
    tags  Taggable[]
}

model Calendar {
    id String @id @db.Uuid

    user   User    @relation(fields: [id], references: [id], onDelete: Cascade)
    events Event[]
}

model Event {
    id String @id @default(uuid()) @db.Uuid

    title       String
    description String
    importance  Importance
    color       String

    calendar   Calendar    @relation(fields: [calendarId], references: [id], onDelete: Cascade)
    calendarId String      @db.Uuid
    eventTimes EventTime[]
    tags       Taggable[]
}

enum Importance {
    LOW
    MEDIUM
    HIGH
}

model EventTime {
    id String @id @default(uuid()) @db.Uuid

    dateTimeStart DateTime
    dateTimeEnd   DateTime

    event   Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)
    eventId String @db.Uuid
}

model FlashDeck {
    id String @id @default(uuid()) @db.Uuid

    title       String
    description String  @default("")
    color       String

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
    userId     String      @db.Uuid
    icon       Icon        @relation(fields: [iconId], references: [id])
    iconId     String      @db.Uuid
    notebook   Notebook?   @relation(fields: [notebookId], references: [id])
    notebookId String?     @db.Uuid
    flashCards FlashCard[]
    tags       Taggable[]
}

model FlashCard {
    id String @id @default(uuid()) @db.Uuid

    question String

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    flashDeck   FlashDeck     @relation(fields: [flashDeckId], references: [id])
    flashDeckId String        @db.Uuid
    answers     FlashAnswer[]
}

model FlashAnswer {
    id String @id @default(uuid()) @db.Uuid

    answer    String  @default("")
    isCorrect Boolean @default(false)

    flashCard   FlashCard @relation(fields: [flashCardId], references: [id], onDelete: Cascade)
    flashCardId String    @db.Uuid
}

model Icon {
    id   String @id @default(uuid()) @db.Uuid
    icon Bytes

    notebooks  Notebook[]
    flashDecks FlashDeck[]
}

model Taggable {
    id String @id @default(uuid()) @db.Uuid

    tag         Tag        @relation(fields: [tagId], references: [id], onDelete: Cascade)
    tagId       String     @db.Uuid
    notebook    Notebook?  @relation(fields: [notebookId], references: [id], onDelete: Cascade)
    notebookId  String?    @db.Uuid
    flashDeck   FlashDeck? @relation(fields: [flashDeckId], references: [id], onDelete: Cascade)
    flashDeckId String?    @db.Uuid
    event       Event?     @relation(fields: [eventId], references: [id], onDelete: Cascade)
    eventId     String?    @db.Uuid
    note        Note?      @relation(fields: [noteId], references: [id], onDelete: Cascade)
    noteId      String?    @db.Uuid
}

model Tag {
    id    String @id @default(uuid()) @db.Uuid
    tag   String
    color String

    taggables Taggable[]
    user      User       @relation(fields: [userId], references: [id])
    userId    String     @db.Uuid
}
